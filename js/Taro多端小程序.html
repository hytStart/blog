<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Taro，作为React开发者，使用感受 | hyt &#39;s blog</title>
    <meta name="description" content="ctrl c + ctrl v">
    <link rel="apple-touch-icon" href="/blog/imges/logo.ico">
  <link rel="manifest" href="/blog/manifest.json">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f5b7da27.css" as="style"><link rel="preload" href="/blog/assets/js/app.fc903cc6.js" as="script"><link rel="preload" href="/blog/assets/js/2.7b4b14dc.js" as="script"><link rel="preload" href="/blog/assets/js/11.f3c9ad63.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.e3199f8a.js"><link rel="prefetch" href="/blog/assets/js/12.4aab7abd.js"><link rel="prefetch" href="/blog/assets/js/13.64e54b8e.js"><link rel="prefetch" href="/blog/assets/js/14.5bb22b7a.js"><link rel="prefetch" href="/blog/assets/js/15.d9766f80.js"><link rel="prefetch" href="/blog/assets/js/3.f3a2b0d2.js"><link rel="prefetch" href="/blog/assets/js/4.7bf71852.js"><link rel="prefetch" href="/blog/assets/js/5.2e6920b3.js"><link rel="prefetch" href="/blog/assets/js/6.334279c2.js"><link rel="prefetch" href="/blog/assets/js/7.62bbcd01.js"><link rel="prefetch" href="/blog/assets/js/8.3a3c7b63.js"><link rel="prefetch" href="/blog/assets/js/9.16f23ba3.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f5b7da27.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">hyt 's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/blog/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/js/" class="nav-link router-link-active">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/hytStart" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/blog/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/js/" class="nav-link router-link-active">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/hytStart" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/js/" class="sidebar-link">javascript</a></li><li><a href="/blog/js/Cocos Creator.html" class="sidebar-link">初识cocos creator ，做一款属于自己的小游戏</a></li><li><a href="/blog/js/Taro多端小程序.html" class="active sidebar-link">Taro，作为React开发者，使用感受</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="taro，作为react开发者，使用感受"><a href="#taro，作为react开发者，使用感受" aria-hidden="true" class="header-anchor">#</a> Taro，作为React开发者，使用感受</h1> <p>继去年毕设，使用小程序原生语言开发了一个英语学习小程序<a href="https://github.com/hytStart/smart-english-study" target="_blank" rel="noopener noreferrer">（smart英语学习》》）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以后，一年没有写过小程序了。最近心血来潮，准备用很火的Taro(类似于react语法，多端)开发一个课堂签到小程序，踩踩坑，感受一下。</p> <h5 id="本文概要"><a href="#本文概要" aria-hidden="true" class="header-anchor">#</a> 本文概要</h5> <ol><li>使用Taro，redux开发的学生课堂签到小程序展示</li> <li>*Taro的基本使用</li> <li>*作为React开发者，使用的注意事项（仅包括实践中遇到的）</li> <li>实际开发中的处理</li> <li>Taro以及微信小程序开发中遇到的问题总结</li> <li>TODO</li></ol> <h4 id="一、签到小程序"><a href="#一、签到小程序" aria-hidden="true" class="header-anchor">#</a> 一、签到小程序</h4> <blockquote><p>功能概述：基于地理位置（经纬度）的签到平台。另外包括校内新闻模块，word资料下载模块，个人信息模块等。扫码登录： 学生体验账号 123456，密码 123456。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/4/4/169e686add307ee6?w=258&amp;h=258&amp;f=png&amp;s=83526" alt="小程序码"> <a href="https://github.com/hytStart/Taro-sign" target="_blank" rel="noopener noreferrer">源码戳这里》》》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h5 id="_1-基于腾讯api经纬度的签到"><a href="#_1-基于腾讯api经纬度的签到" aria-hidden="true" class="header-anchor">#</a> 1. 基于腾讯api经纬度的签到</h5> <p><img src="https://user-gold-cdn.xitu.io/2019/4/4/169e683cf6af662a?w=1440&amp;h=1080&amp;f=png&amp;s=622214" alt=""></p> <h5 id="_2-新闻部分，word资料下载"><a href="#_2-新闻部分，word资料下载" aria-hidden="true" class="header-anchor">#</a> 2. 新闻部分，word资料下载</h5> <p><img src="https://user-gold-cdn.xitu.io/2019/4/4/169e684be1145c2a?w=1440&amp;h=1080&amp;f=png&amp;s=1065020" alt=""></p> <h5 id="_3-个人信息模块"><a href="#_3-个人信息模块" aria-hidden="true" class="header-anchor">#</a> 3. 个人信息模块</h5> <p><img src="https://user-gold-cdn.xitu.io/2019/4/4/169e684ea0eab136?w=1080&amp;h=1080&amp;f=png&amp;s=313092" alt=""></p> <h4 id="二、taro的基本使用"><a href="#二、taro的基本使用" aria-hidden="true" class="header-anchor">#</a> 二、Taro的基本使用</h4> <ol><li><code>yarn global add @tarojs/cli</code>，使用 yarn 安装 CLI</li> <li><code>taro init myApp</code> 创建模板项目(按照一系列默认命令，即可创建redux ，mobx等生成器模板)。并且之后会默认安装依赖。</li> <li><code>npm un dev:weap</code> ，进入微信开发工具查看自己的小程序。</li> <li>具体组件和api和小程序相似，可查看<a href="https://nervjs.github.io/taro/docs/README.html" target="_blank" rel="noopener noreferrer">Taro文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>自行了解。</li> <li>之后开发就类似于React了。注意<code>componentDidShow、 componentDidMount</code>生命周期在小程序中的不同表现。tab页<code>componentDidMount</code>只走一次。</li></ol> <p>备注：Taro 默认对小程序的异步 API 进行了包装，可以像使用 Promise 那样进行调用。</p> <div class="language- extra-class"><pre class="language-text"><code>// WX
wx.request({
    url: '', // 仅为示例，并非真实的接口地址
    data: {},
    header: {
      'content-type': 'application/json' // 默认值
    },
    success(res) {}
})
// Taro
Taro.request(url).then(function (res) {
    console.log(res)
})
</code></pre></div><h4 id="三、作为react开发者，使用的注意事项（仅包括实践中遇到的）"><a href="#三、作为react开发者，使用的注意事项（仅包括实践中遇到的）" aria-hidden="true" class="header-anchor">#</a> 三、作为React开发者，使用的注意事项（仅包括实践中遇到的）</h4> <ul><li><p><code>sourcemap</code>不能用就很xxxxx</p></li> <li><p>不能解构传值，需要<code>key value</code>传给子组件</p></li> <li><p>不能在<code>render</code>之外写<code>jsx</code></p></li> <li><p><code>this.props</code>传来的函数必须<code>on</code>或者<code>dispatch</code>开头</p></li> <li><p>父组件传来的<code>props</code>,必须定义在<code>static defaultProps</code>里，要不然获取不到</p></li> <li><p><code>componentDidMount</code>,在微信/百度/字节跳动/支付宝小程序中这一生命周期方法对应 app 的 <code>onLaunch</code></p></li> <li><p><code>componentDidShow</code>在微信/百度/字节跳动/支付宝小程序中这一生命周期方法对应 <code>onShow</code></p></li> <li><p><code>componentDidHide</code>在微信/百度/字节跳动/支付宝小程序中这一生命周期方法对应 <code>onHide</code></p></li> <li><p>JS 代码里必须书写单引号，特别是 JSX 中，如果出现双引号，可能会导致编译错误</p></li> <li><p>环境变量 <code>process.env</code> 的使用,不要以解构的方式来获取通过 <code>env</code> 配置的 <code>process.env</code> 环境变量，请直接以完整书写的方式 <code>process.env.NODE_ENV</code> 来进行使用</p></li> <li><p>使用 <code>this.$componentType</code> 来判断当前 <code>Taro.Component</code> 是页面还是组件,可能取值分别为 <code>PAGE</code> 和 <code>COMPONENT</code></p></li> <li><p>不支持无状态组件</p></li> <li><p>不能在包含 JSX 元素的 <code>map</code> 循环中使用 <code>if</code> 表达式</p></li> <li><p>不能使用 <code>Array#map</code> 之外的方法操作 JSX 数组</p></li> <li><p>父组件要往子组件传递函数，属性名必须以 <code>on</code> 开头</p></li></ul> <p>以上是使用过程中遇到的问题，<a href="https://nervjs.github.io/taro/docs/best-practice.html" target="_blank" rel="noopener noreferrer">更多注意事项请查阅官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="四、实际开发中的处理"><a href="#四、实际开发中的处理" aria-hidden="true" class="header-anchor">#</a> 四、实际开发中的处理</h4> <h5 id="_1-alias同样可以使用。"><a href="#_1-alias同样可以使用。" aria-hidden="true" class="header-anchor">#</a> 1. alias同样可以使用。</h5> <div class="language- extra-class"><pre class="language-text"><code>// config/index.js
alias: {
    '@actions': path.resolve(__dirname, '..', 'src/actions'),
    '@assets': path.resolve(__dirname, '..', 'src/assets'),
    '@components': path.resolve(__dirname, '..', 'src/components'),
    '@constants': path.resolve(__dirname, '..', 'src/constants'),
    '@reducers': path.resolve(__dirname, '..', 'src/reducers'),
    '@style': path.resolve(__dirname, '..', 'src/style'),
    '@util': path.resolve(__dirname, '..', 'src/util')
  },
</code></pre></div><h5 id="_2-taro-requset-的简单处理"><a href="#_2-taro-requset-的简单处理" aria-hidden="true" class="header-anchor">#</a> 2. Taro.requset()的简单处理</h5> <div class="language- extra-class"><pre class="language-text"><code>// feth.js
import Taro from '@tarojs/taro'

const defaultMethod = 'POST'
const successStatus = 200
const successFlag = 1
const messageToast = title =&gt; {
    Taro.showToast({
        title,
        icon: 'none',
        duration: 1000
    })
}

export default function fetch(options) {
    const { 
        url,
        method = defaultMethod,
        params,
        showErrorToast = true,
    } = options
    return Taro.request({
        url,
        method,
        data: params,
    }).then(response =&gt; {
        const { statusCode, data } = response
        // 不是200以外的
        if (statusCode != successStatus) {
            const { error } = data
            // reject出去。showToast在catch里执行。
            const errMessage = {errMsg: error || '请求接口失败'}
            return Promise.reject(errMessage)
        } else {
            // flag是不是1的判断
            const { flag, message, data: datas } = data
            if (flag == successFlag) {
                return Promise.resolve(datas)
            } else {
                const errMessage = {errMsg: message || '流程错误'}
                return Promise.reject(errMessage)
            }
        }
    }).catch(errors =&gt; {
        const { errMsg } = errors
        if (showErrorToast) {
            messageToast(errMsg || '发起请求异常')
        }
        const errMessage = errMsg || '发起请求异常'
        return Promise.reject(errMessage)
    })
}
</code></pre></div><h5 id="_3-单击按钮，滚动到相应节点"><a href="#_3-单击按钮，滚动到相应节点" aria-hidden="true" class="header-anchor">#</a> 3. 单击按钮，滚动到相应节点</h5> <div class="language- extra-class"><pre class="language-text"><code>toggleComments = () =&gt; {
    Taro.createSelectorQuery().select('#comments-id').boundingClientRect(function(rect){
        // 使页面滚动到响应位置
        Taro.pageScrollTo({
            scrollTop: rect.bottom
        })
    }).exec()
}
</code></pre></div><h4 id="五、taro以及微信小程序开发中遇到的问题总结"><a href="#五、taro以及微信小程序开发中遇到的问题总结" aria-hidden="true" class="header-anchor">#</a> 五、Taro以及微信小程序开发中遇到的问题总结</h4> <h5 id="_1-doc文档的下载与预览"><a href="#_1-doc文档的下载与预览" aria-hidden="true" class="header-anchor">#</a> 1. doc文档的下载与预览</h5> <blockquote><p>小程序目前提供了wx.downloadFile的API，但目前只支持长传和下载图片，语音，视频 三种类型的文件。doc文件会下载为临时路径的 .myword文件，可供预览（安卓手机默认微信内置浏览器打开,可转发至电脑。ios tbd）。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Taro.showLoading()
const params = {
    url,
    fileType: &quot;doc&quot;,
    success(res) {
        // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容
        if (res.statusCode === 200) {
            const wxPath = res.tempFilePath
            Taro.openDocument({
                filePath: wxPath,
                fileType: &quot;doc&quot;,
                success: function (ress) {
                    Taro.hideLoading()
                    console.log(ress)
                },
                fail: function (resfo) {
                    Taro.hideLoading()
                    util.showToast('打开文档失败')
                }
            })
        }
    },
    fail: function (resfd) {
        Taro.hideLoading()
        util.showToast('文件下载失败')
    },
}
Taro.downloadFile(params).then()
</code></pre></div><h5 id="_2-获取地理位置，经纬度，用于签到"><a href="#_2-获取地理位置，经纬度，用于签到" aria-hidden="true" class="header-anchor">#</a> 2. 获取地理位置，经纬度，用于签到</h5> <div class="language- extra-class"><pre class="language-text"><code>wx.getLocation({
  type: 'gcj02', // wgs84 返回 gps 坐标，gcj02 返回可用于 wx.openLocation 的坐标
  success(res) {
    const { latitude, longitude } = res
  }
})
</code></pre></div><blockquote><p>①、wx.getLocation，调用前需要 用户授权。scope.userLocation<br>
②、发起签到与扫码签到时，应保证<code>type</code>相同。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// 用户授权，app.js中配置项
permission: {
    &quot;scope.userLocation&quot;: {
        &quot;desc&quot;: &quot;获取用户的签到位置&quot;
    }
},
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/4/4/169e6c43a907af8e?w=1077&amp;h=1725&amp;f=png&amp;s=353779" alt=""></p> <h5 id="_3-不能长按识别-除小程序码外的-二维码-tbd"><a href="#_3-不能长按识别-除小程序码外的-二维码-tbd" aria-hidden="true" class="header-anchor">#</a> 3. 不能长按识别(除小程序码外的)二维码 (tbd)</h5> <blockquote><p>预览二维码图片以后，不支持识别二维码。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>getEventData(data, tag) {
    return data.currentTarget.dataset[tag];
},
previewImage = (e) =&gt; {
    const current = getEventData(e, 'src')
    Taro.previewImage({
        current: current, // 当前显示图片的http链接   
        urls: [current] // 需要预览的图片http链接列表   
    })
}
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/4/4/169e6e3c930ca93d?w=1080&amp;h=1716&amp;f=png&amp;s=126282" alt="二维码"></p> <h4 id="六、todo"><a href="#六、todo" aria-hidden="true" class="header-anchor">#</a> 六、TODO</h4> <ul><li>发挥多端的优势，尝试其他小程序，h5等的打包发布。</li> <li>继续跟进word文档下载，更换二维码为小程序二维码带参数（<code>wxacode.getUnlimited</code>）</li> <li>openid对于多端的影响</li></ul> <h4 id="尾语"><a href="#尾语" aria-hidden="true" class="header-anchor">#</a> 尾语</h4> <p>==菜的抠脚，大佬轻喷。内容较粗糙，有问题请指正。==
有必要夸一下，小程序的处理速度还是很快的，两个小时审核就通过了。
<img src="https://user-gold-cdn.xitu.io/2019/4/4/169e6f3c8fbeeedf?w=1301&amp;h=274&amp;f=png&amp;s=24244" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/js/Cocos Creator.html" class="prev">
          初识cocos creator ，做一款属于自己的小游戏
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.fc903cc6.js" defer></script><script src="/blog/assets/js/2.7b4b14dc.js" defer></script><script src="/blog/assets/js/11.f3c9ad63.js" defer></script>
  </body>
</html>
