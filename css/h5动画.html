<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>年终活动h5动画总结 | hyt &#39;s blog</title>
    <meta name="description" content="ctrl c + ctrl v">
    <link rel="apple-touch-icon" href="/blog/imges/logo.ico">
  <link rel="manifest" href="/blog/manifest.json">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f5b7da27.css" as="style"><link rel="preload" href="/blog/assets/js/app.fc903cc6.js" as="script"><link rel="preload" href="/blog/assets/js/2.7b4b14dc.js" as="script"><link rel="preload" href="/blog/assets/js/8.3a3c7b63.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.e3199f8a.js"><link rel="prefetch" href="/blog/assets/js/11.f3c9ad63.js"><link rel="prefetch" href="/blog/assets/js/12.4aab7abd.js"><link rel="prefetch" href="/blog/assets/js/13.64e54b8e.js"><link rel="prefetch" href="/blog/assets/js/14.5bb22b7a.js"><link rel="prefetch" href="/blog/assets/js/15.d9766f80.js"><link rel="prefetch" href="/blog/assets/js/3.f3a2b0d2.js"><link rel="prefetch" href="/blog/assets/js/4.7bf71852.js"><link rel="prefetch" href="/blog/assets/js/5.2e6920b3.js"><link rel="prefetch" href="/blog/assets/js/6.334279c2.js"><link rel="prefetch" href="/blog/assets/js/7.62bbcd01.js"><link rel="prefetch" href="/blog/assets/js/9.16f23ba3.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f5b7da27.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">hyt 's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/blog/css/" class="nav-link router-link-active">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/js/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/hytStart" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/blog/css/" class="nav-link router-link-active">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/js/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/hytStart" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/css/" class="sidebar-link">css</a></li><li><a href="/blog/css/h5动画.html" class="active sidebar-link">年终活动h5动画总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/css/h5动画.html#年终活动h5动画总结" class="sidebar-link">年终活动h5动画总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/css/h5动画.html#_1-动画相关主要内容：" class="sidebar-link">1. 动画相关主要内容：</a></li><li class="sidebar-sub-header"><a href="/blog/css/h5动画.html#_2-css3动画语法" class="sidebar-link">2. css3动画语法</a></li><li class="sidebar-sub-header"><a href="/blog/css/h5动画.html#_3-示例-https-github-com-hytstart-react-chouchou-blob-master-src-components-home-ui-action-action-scss" class="sidebar-link">3. 示例 https://github.com/hytStart/React_chouchou/blob/master/src/components/home/ui/action/action.scss</a></li><li class="sidebar-sub-header"><a href="/blog/css/h5动画.html#_4-动画总结" class="sidebar-link">4. 动画总结</a></li><li class="sidebar-sub-header"><a href="/blog/css/h5动画.html#_5-待完善" class="sidebar-link">5. 待完善</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="年终活动h5动画总结"><a href="#年终活动h5动画总结" aria-hidden="true" class="header-anchor">#</a> 年终活动h5动画总结</h2> <p>戳这里<a href="https://github.com/hytStart/React_chouchou" target="_blank" rel="noopener noreferrer">----♂--github--<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>css3 + react-id-swiper + react + redux + saga<br>
采用postcss的Autoprefixer插件，即可满足大多数oppo，vivo手机的兼容性问题。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809d17fdbe0442?w=339&amp;h=575&amp;f=png&amp;s=100585" alt=""></p> <h3 id="_1-动画相关主要内容："><a href="#_1-动画相关主要内容：" aria-hidden="true" class="header-anchor">#</a> 1. 动画相关主要内容：</h3> <ol><li>流星</li> <li>闪烁星星</li> <li>字的晃动</li> <li>人的移动（动画 + 监听动画结束时间）</li> <li>桥的铺垫</li> <li>开启旅程按钮缩放</li> <li>旋转（+ 兼容）</li> <li>react-id-swiper</li> <li>swiper配合css3实现切换</li></ol> <h3 id="_2-css3动画语法"><a href="#_2-css3动画语法" aria-hidden="true" class="header-anchor">#</a> 2. css3动画语法</h3> <ul><li>animation</li></ul> <div class="language- extra-class"><pre class="language-text"><code>animation-name
animation-duration
animation-timing-function  速度曲线
animation-delay
animation-iteration-count
animation-direction
play-state	
fill-mode  
</code></pre></div><ul><li>transform</li></ul> <blockquote><p>transform 属性向元素应用 2D 或 3D 转换。该属性允许我们对元素进行旋转、缩放、移动或倾斜。
其中 transform-origin (属性改变被转换元素的中心)。</p></blockquote> <ul><li>transition</li></ul> <blockquote><p>三者区别：  animation  动画,关键帧，往复性。  transition  过渡, 属性，触发动作，一过性。  transform 变换, 复杂的变换参数。</p></blockquote> <h3 id="_3-示例-https-github-com-hytstart-react-chouchou-blob-master-src-components-home-ui-action-action-scss"><a href="#_3-示例-https-github-com-hytstart-react-chouchou-blob-master-src-components-home-ui-action-action-scss" aria-hidden="true" class="header-anchor">#</a> 3. 示例 https://github.com/hytStart/React_chouchou/blob/master/src/components/home/ui/action/action.scss</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809a989e503c84?w=1145&amp;h=543&amp;f=png&amp;s=50792" alt=""></p> <ul><li>流星</li></ul> <blockquote><p>改变位置<code>translate3d</code>,透明度<code>opacity</code>和大小<code>scale</code>。<br>
流星尾巴采用伪元素元素<code>:after</code>旋转<code>-45deg</code>(旋转基点为左<code>transform-origin: left;</code>)；采用<code>border</code>可以实现，靠近头部越亮，靠近尾部越暗。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809aa3a02a052d?w=264&amp;h=297&amp;f=png&amp;s=5776" alt="图一 流星"></p> <div class="language- extra-class"><pre class="language-text"><code>.star {
    display: block;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: #FFF;
    top: 10px;
    left: 200px;
    position: relative;
    animation: star-ani 6s infinite ease-out;
    box-shadow: 0 0 5px 5px rgba(255, 255, 255, .3);
    opacity: 1;
}
.star:after {
    content: '';
    display: block;
    top: 0px;
    left: 40%;
    border: 0px solid #fff;
    border-width: 0px 90px 2px 90px;
    border-color: transparent transparent transparent rgba(255, 255, 255, .3);
    transform: rotate(-45deg) translate3d(1px, 3px, 0);
    box-shadow: 0 0 1px 0 rgba(255, 255, 255, .1);
    transform-origin: left;
}

@keyframes star-ani {
    0% {
        opacity: 0;
        transform: scale(0) rotate(0) translate3d(0, 0, 0);
    }
    50% {
        opacity: 1;
        transform: scale(1) rotate(0) translate3d(-100px, 100px, 0);
    }
    100% {
        opacity: 0;
        transform: scale(1) rotate(0) translate3d(-200px, 200px, 0);
    }
}
</code></pre></div><ul><li>闪烁星星</li></ul> <blockquote><p>改变透明度</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809ad21ecdf2be?w=260&amp;h=297&amp;f=png&amp;s=5815" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>.shine {
    background: url('../../../../images/action/icon-star1.png') no-repeat center;
    background-size: 100%;
    width: 30px;
    height: 40px;
    position: absolute;
    top: 90px;
    left: 100px;
    opacity: 0;
    animation: opacity-change 0.5s ease-in-out infinite;
}

@keyframes opacity-change {
    0% {
        opacity: 0;
    }
    50% {
        opacity: 1;
    }
    100% {
        opacity: 0;
    }
}
</code></pre></div><ul><li>字</li></ul> <blockquote><p>分为两段动画，下降和上升。<code>translateY</code>改变即可。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809b1fdfc80093?w=265&amp;h=297&amp;f=png&amp;s=5849" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>.text-item-0 {
    position: absolute;
    width: 25px;
    height: 75px;
    top: 60px;
    left: 100px;
    background: url('../../../../images/action/S-start.png') no-repeat center;
    background-size: 100%;
    animation: letter-0 1.5s ease-in-out both, letter-0-1 2.0s ease-in-out 1.5s both;
}

@keyframes letter-0 {
    0% {
        transform: translateY(0)
    }
    50% {
        transform: translateY(80px)
    }
    100% {
        transform: translateY(0px)
    }
}
@keyframes letter-0-1 {
    0% {
        opacity: 1;
    }
    100% {
        top: -80px;
        opacity: 0;
    }
}
</code></pre></div><ul><li>人移动</li></ul> <blockquote><p>切换dom，添加类控制移动和暂停，以及切换背景人物。监听<code>animationend</code>事件。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809b147f8f40dd?w=296&amp;h=302&amp;f=png&amp;s=5570" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>jsx
{
    peopleMove ?
        &lt;div
            className={`${style.people_move} ${!pausedState &amp;&amp; style.people_paused}`}
            ref={start2 =&gt; { this.start2 = start2 }}
        /&gt;
        :
        &lt;div className={style.people} /&gt;
}
css
.people {
    width: 20px;
    height: 64px;
    position: absolute;
    left: 10px;
    top: 130px;
    background: url('../../../../images/action/people.png') no-repeat center;
    background-size: 100%; 
    opacity: 0;
    animation: peopleUp 1s ease-in-out 0.5s both;
}
.people_move {
    background: url('../../../../images/action/people_moveleft.gif');
    background-size: 100% 100%;
    background-position: center;
    background-repeat: no-repeat;
    width: 20px;
    height: 64px;
    position: absolute;
    left: 10px;
    top: 130px;
    opacity: 1;
    animation: PeopleMove 1.5s linear 0s both;
}
.people_paused {
    width: 20px;
    height: 64px;
    background: url('../../../../images/action/people.png');
    background-size: 100% 100%;
    background-position: center;
    background-repeat: no-repeat;
    animation-play-state: paused;
}

@keyframes peopleUp {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}
@keyframes PeopleMove {
    0% {
        left: 10px;
        top: 130px;
    }
    100% {
        top: 20px;
        left: 180px;
        background-size: 100% 100%;
        background-position: center;
        background-repeat: no-repeat;
    }
}

// 监听动画结束时机
componentDidUpdate() {
    const { peopleMove } = this.state
    if (peopleMove) {
        this.start2.addEventListener('animationend', this.end)
        this.start2.addEventListener('webkitAnimationEnd', this.end)
        this.start2.addEventListener('mozAnimationEnd', this.end)
        this.start2.addEventListener('oAnimationEnd', this.end)
    }
}
</code></pre></div><ul><li>桥的出现</li></ul> <blockquote><p>配合<code>background-size: cover;</code>属性实现。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809b6b6d34edb8?w=264&amp;h=294&amp;f=png&amp;s=8279" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>.brige {
    width: 0px;
    background: url('../../../../images/action/bridge.png');
    background-size: cover;
    background-repeat: no-repeat;
    height: 100px;
    position: absolute;
    top: 40px;
    left: 30px;
    animation: BridgeFadeIn 3s linear both;
    opacity: 0;
}

@keyframes BridgeFadeIn {
    0% {
        width: 0px;
        opacity: 0;
    }
    100% {
        width: 200px;
        opacity: 1;
    }
}
</code></pre></div><ul><li>渐变大（开始旅程）</li></ul> <blockquote><p>利用<code>transform scale</code>2D 缩放转换。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809b8db89c071b?w=262&amp;h=297&amp;f=png&amp;s=5793" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>.icon-ciecle {
    display: block;
    position: absolute;
    left: 100px;
    top: 80px;
    width: 30px;
    height: 30px;
    background: url('../../../../images/action/icon-light.png') no-repeat center;
    background-size: 100%; 
    animation: warn 1.2s ease-in-out 0s infinite both;
}

@keyframes warn {
    0% {
        transform: scale(0.1);
        opacity: 0.0;
    }
    25% {
        transform: scale(0.2);
        opacity: 0.3;
    }
    50% {
        transform: scale(0.4);
        opacity: 0.5;
    }
    75% {
        transform: scale(0.6);
        opacity: 0.7;
    }
    100% {
        transform: scale(0.8);
        opacity: 0.0;
    }
}
</code></pre></div><ul><li>旋转</li></ul> <blockquote><p>ios的<code>animation-play-state: paused;</code>不起作用，且<code>animation</code>动画不可写在新增类里，必须写在一个类里。（测试中发现，这里有疑问。）</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809bc02e9c79c5?w=264&amp;h=297&amp;f=png&amp;s=6607" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/1/1/16809bc61ead0636?w=263&amp;h=298&amp;f=png&amp;s=7018" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>.music_img {
    width: 40px;
    height: 40px;
    display: block;
    position: absolute;
    left: 100px;
    top: 80px;
    animation: rotating 3s linear infinite;
    animation-play-state: running;
}
.rotate-pause {
    animation-play-state: paused;
}

@keyframes rotating {
    0% {
    	transform: rotate(0deg);
     }
    100% { 
	transform: rotate(360deg);
     }
}
</code></pre></div><ul><li>react-id-swiper</li></ul> <blockquote><p>Swiper的react版本，基本api都支持，具实验目测相当于Swiper v4。</p> <ol><li>不一定通过api。也可以通过重写css实现。</li> <li>重写css切换效果的话，会影响它本身的动画效果，所以可通过添加不可滑动来控制。</li></ol></blockquote> <div class="language- extra-class"><pre class="language-text"><code>1. 
.swiper-wrapper {
    transition-delay: 1.6s;
}
2. 
noSwiping: true,
noSwipingClass: 'stop-swiping',
</code></pre></div><ul><li>Swiper实现的迷宫切换</li></ul> <blockquote><p>1.swiper的<code>effect</code>属性与控制背景图片的<code>opacity</code>，利用时间差实现最终效果。包括迷宫的切换，背包男的出现与消失，弹窗的出现与消失。<br>
2.swiper属性的<code>activeIndex</code>，可以得到滑动到第几页，通过改变<code>dom</code>或者改变类，控制第几页动画的发生。</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/1/2/1680d67b8a2e6879?w=1440&amp;h=1080&amp;f=png&amp;s=1015037" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>// 根据activeIndex拿到的页数，控制该页数state的改变，通过切换dom和添加类的方式，达到进场与退场的动画效果。
// 添加类stop-swiping控制不可滑动，动画完成后，才可继续滑动下一页。
const mazeStyle = classNames({
    [styles['maze-1']]: true,
    [styles['maze-out']]: firstMazeOut,
})
const peopleStyle = classNames({
    [styles['people-1']]: true,
    [styles['people-out']]: firstMazeOut,
})
const popCardStyle = classNames({
    [styles['pop-card-container']]: true,
    [styles['pop-card-out']]: firstMazeOut,
})
{
    firstMazeIn ?
        &lt;div className={!isSlideFirst &amp;&amp; &quot;stop-swiping&quot;}&gt;
            &lt;div className={styles['maze-container']}&gt;
                &lt;div className={mazeStyle} /&gt;
                &lt;div className={peopleStyle} /&gt;
            &lt;/div&gt;
            &lt;div className={popCardStyle}&gt;
                &lt;ModalScene {...this.props} /&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        :
        &lt;div /&gt;    // 不添加会影响swiper自身页数的判断
}
</code></pre></div><h3 id="_4-动画总结"><a href="#_4-动画总结" aria-hidden="true" class="header-anchor">#</a> 4. 动画总结</h3> <blockquote><p>别人写的真牛X,自己只会<code>opacity</code>,<code>translate</code>。</p></blockquote> <h3 id="_5-待完善"><a href="#_5-待完善" aria-hidden="true" class="header-anchor">#</a> 5. 待完善</h3> <ul><li>html2canvas</li> <li>资源加载</li> <li>jsbridge使用与注意事项</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/css/" class="prev router-link-active">
          css
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.fc903cc6.js" defer></script><script src="/blog/assets/js/2.7b4b14dc.js" defer></script><script src="/blog/assets/js/8.3a3c7b63.js" defer></script>
  </body>
</html>
