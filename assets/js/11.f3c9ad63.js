(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{195:function(e,t,a){"use strict";a.r(t);var r=a(0),s=Object(r.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"taro，作为react开发者，使用感受"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#taro，作为react开发者，使用感受","aria-hidden":"true"}},[e._v("#")]),e._v(" Taro，作为React开发者，使用感受")]),e._v(" "),a("p",[e._v("继去年毕设，使用小程序原生语言开发了一个英语学习小程序"),a("a",{attrs:{href:"https://github.com/hytStart/smart-english-study",target:"_blank",rel:"noopener noreferrer"}},[e._v("（smart英语学习》》）"),a("OutboundLink")],1),e._v("以后，一年没有写过小程序了。最近心血来潮，准备用很火的Taro(类似于react语法，多端)开发一个课堂签到小程序，踩踩坑，感受一下。")]),e._v(" "),a("h5",{attrs:{id:"本文概要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本文概要","aria-hidden":"true"}},[e._v("#")]),e._v(" 本文概要")]),e._v(" "),a("ol",[a("li",[e._v("使用Taro，redux开发的学生课堂签到小程序展示")]),e._v(" "),a("li",[e._v("*Taro的基本使用")]),e._v(" "),a("li",[e._v("*作为React开发者，使用的注意事项（仅包括实践中遇到的）")]),e._v(" "),a("li",[e._v("实际开发中的处理")]),e._v(" "),a("li",[e._v("Taro以及微信小程序开发中遇到的问题总结")]),e._v(" "),a("li",[e._v("TODO")])]),e._v(" "),a("h4",{attrs:{id:"一、签到小程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、签到小程序","aria-hidden":"true"}},[e._v("#")]),e._v(" 一、签到小程序")]),e._v(" "),a("blockquote",[a("p",[e._v("功能概述：基于地理位置（经纬度）的签到平台。另外包括校内新闻模块，word资料下载模块，个人信息模块等。扫码登录： 学生体验账号 123456，密码 123456。")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/4/169e686add307ee6?w=258&h=258&f=png&s=83526",alt:"小程序码"}}),e._v(" "),a("a",{attrs:{href:"https://github.com/hytStart/Taro-sign",target:"_blank",rel:"noopener noreferrer"}},[e._v("源码戳这里》》》"),a("OutboundLink")],1)]),e._v(" "),a("h5",{attrs:{id:"_1-基于腾讯api经纬度的签到"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-基于腾讯api经纬度的签到","aria-hidden":"true"}},[e._v("#")]),e._v(" 1. 基于腾讯api经纬度的签到")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/4/169e683cf6af662a?w=1440&h=1080&f=png&s=622214",alt:""}})]),e._v(" "),a("h5",{attrs:{id:"_2-新闻部分，word资料下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-新闻部分，word资料下载","aria-hidden":"true"}},[e._v("#")]),e._v(" 2. 新闻部分，word资料下载")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/4/169e684be1145c2a?w=1440&h=1080&f=png&s=1065020",alt:""}})]),e._v(" "),a("h5",{attrs:{id:"_3-个人信息模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-个人信息模块","aria-hidden":"true"}},[e._v("#")]),e._v(" 3. 个人信息模块")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/4/169e684ea0eab136?w=1080&h=1080&f=png&s=313092",alt:""}})]),e._v(" "),a("h4",{attrs:{id:"二、taro的基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、taro的基本使用","aria-hidden":"true"}},[e._v("#")]),e._v(" 二、Taro的基本使用")]),e._v(" "),a("ol",[a("li",[a("code",[e._v("yarn global add @tarojs/cli")]),e._v("，使用 yarn 安装 CLI")]),e._v(" "),a("li",[a("code",[e._v("taro init myApp")]),e._v(" 创建模板项目(按照一系列默认命令，即可创建redux ，mobx等生成器模板)。并且之后会默认安装依赖。")]),e._v(" "),a("li",[a("code",[e._v("npm un dev:weap")]),e._v(" ，进入微信开发工具查看自己的小程序。")]),e._v(" "),a("li",[e._v("具体组件和api和小程序相似，可查看"),a("a",{attrs:{href:"https://nervjs.github.io/taro/docs/README.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Taro文档"),a("OutboundLink")],1),e._v("自行了解。")]),e._v(" "),a("li",[e._v("之后开发就类似于React了。注意"),a("code",[e._v("componentDidShow、 componentDidMount")]),e._v("生命周期在小程序中的不同表现。tab页"),a("code",[e._v("componentDidMount")]),e._v("只走一次。")])]),e._v(" "),a("p",[e._v("备注：Taro 默认对小程序的异步 API 进行了包装，可以像使用 Promise 那样进行调用。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// WX\nwx.request({\n    url: '', // 仅为示例，并非真实的接口地址\n    data: {},\n    header: {\n      'content-type': 'application/json' // 默认值\n    },\n    success(res) {}\n})\n// Taro\nTaro.request(url).then(function (res) {\n    console.log(res)\n})\n")])])]),a("h4",{attrs:{id:"三、作为react开发者，使用的注意事项（仅包括实践中遇到的）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、作为react开发者，使用的注意事项（仅包括实践中遇到的）","aria-hidden":"true"}},[e._v("#")]),e._v(" 三、作为React开发者，使用的注意事项（仅包括实践中遇到的）")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("sourcemap")]),e._v("不能用就很xxxxx")])]),e._v(" "),a("li",[a("p",[e._v("不能解构传值，需要"),a("code",[e._v("key value")]),e._v("传给子组件")])]),e._v(" "),a("li",[a("p",[e._v("不能在"),a("code",[e._v("render")]),e._v("之外写"),a("code",[e._v("jsx")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("this.props")]),e._v("传来的函数必须"),a("code",[e._v("on")]),e._v("或者"),a("code",[e._v("dispatch")]),e._v("开头")])]),e._v(" "),a("li",[a("p",[e._v("父组件传来的"),a("code",[e._v("props")]),e._v(",必须定义在"),a("code",[e._v("static defaultProps")]),e._v("里，要不然获取不到")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("componentDidMount")]),e._v(",在微信/百度/字节跳动/支付宝小程序中这一生命周期方法对应 app 的 "),a("code",[e._v("onLaunch")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("componentDidShow")]),e._v("在微信/百度/字节跳动/支付宝小程序中这一生命周期方法对应 "),a("code",[e._v("onShow")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("componentDidHide")]),e._v("在微信/百度/字节跳动/支付宝小程序中这一生命周期方法对应 "),a("code",[e._v("onHide")])])]),e._v(" "),a("li",[a("p",[e._v("JS 代码里必须书写单引号，特别是 JSX 中，如果出现双引号，可能会导致编译错误")])]),e._v(" "),a("li",[a("p",[e._v("环境变量 "),a("code",[e._v("process.env")]),e._v(" 的使用,不要以解构的方式来获取通过 "),a("code",[e._v("env")]),e._v(" 配置的 "),a("code",[e._v("process.env")]),e._v(" 环境变量，请直接以完整书写的方式 "),a("code",[e._v("process.env.NODE_ENV")]),e._v(" 来进行使用")])]),e._v(" "),a("li",[a("p",[e._v("使用 "),a("code",[e._v("this.$componentType")]),e._v(" 来判断当前 "),a("code",[e._v("Taro.Component")]),e._v(" 是页面还是组件,可能取值分别为 "),a("code",[e._v("PAGE")]),e._v(" 和 "),a("code",[e._v("COMPONENT")])])]),e._v(" "),a("li",[a("p",[e._v("不支持无状态组件")])]),e._v(" "),a("li",[a("p",[e._v("不能在包含 JSX 元素的 "),a("code",[e._v("map")]),e._v(" 循环中使用 "),a("code",[e._v("if")]),e._v(" 表达式")])]),e._v(" "),a("li",[a("p",[e._v("不能使用 "),a("code",[e._v("Array#map")]),e._v(" 之外的方法操作 JSX 数组")])]),e._v(" "),a("li",[a("p",[e._v("父组件要往子组件传递函数，属性名必须以 "),a("code",[e._v("on")]),e._v(" 开头")])])]),e._v(" "),a("p",[e._v("以上是使用过程中遇到的问题，"),a("a",{attrs:{href:"https://nervjs.github.io/taro/docs/best-practice.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("更多注意事项请查阅官方文档"),a("OutboundLink")],1)]),e._v(" "),a("h4",{attrs:{id:"四、实际开发中的处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、实际开发中的处理","aria-hidden":"true"}},[e._v("#")]),e._v(" 四、实际开发中的处理")]),e._v(" "),a("h5",{attrs:{id:"_1-alias同样可以使用。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-alias同样可以使用。","aria-hidden":"true"}},[e._v("#")]),e._v(" 1. alias同样可以使用。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// config/index.js\nalias: {\n    '@actions': path.resolve(__dirname, '..', 'src/actions'),\n    '@assets': path.resolve(__dirname, '..', 'src/assets'),\n    '@components': path.resolve(__dirname, '..', 'src/components'),\n    '@constants': path.resolve(__dirname, '..', 'src/constants'),\n    '@reducers': path.resolve(__dirname, '..', 'src/reducers'),\n    '@style': path.resolve(__dirname, '..', 'src/style'),\n    '@util': path.resolve(__dirname, '..', 'src/util')\n  },\n")])])]),a("h5",{attrs:{id:"_2-taro-requset-的简单处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-taro-requset-的简单处理","aria-hidden":"true"}},[e._v("#")]),e._v(" 2. Taro.requset()的简单处理")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// feth.js\nimport Taro from '@tarojs/taro'\n\nconst defaultMethod = 'POST'\nconst successStatus = 200\nconst successFlag = 1\nconst messageToast = title => {\n    Taro.showToast({\n        title,\n        icon: 'none',\n        duration: 1000\n    })\n}\n\nexport default function fetch(options) {\n    const { \n        url,\n        method = defaultMethod,\n        params,\n        showErrorToast = true,\n    } = options\n    return Taro.request({\n        url,\n        method,\n        data: params,\n    }).then(response => {\n        const { statusCode, data } = response\n        // 不是200以外的\n        if (statusCode != successStatus) {\n            const { error } = data\n            // reject出去。showToast在catch里执行。\n            const errMessage = {errMsg: error || '请求接口失败'}\n            return Promise.reject(errMessage)\n        } else {\n            // flag是不是1的判断\n            const { flag, message, data: datas } = data\n            if (flag == successFlag) {\n                return Promise.resolve(datas)\n            } else {\n                const errMessage = {errMsg: message || '流程错误'}\n                return Promise.reject(errMessage)\n            }\n        }\n    }).catch(errors => {\n        const { errMsg } = errors\n        if (showErrorToast) {\n            messageToast(errMsg || '发起请求异常')\n        }\n        const errMessage = errMsg || '发起请求异常'\n        return Promise.reject(errMessage)\n    })\n}\n")])])]),a("h5",{attrs:{id:"_3-单击按钮，滚动到相应节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-单击按钮，滚动到相应节点","aria-hidden":"true"}},[e._v("#")]),e._v(" 3. 单击按钮，滚动到相应节点")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("toggleComments = () => {\n    Taro.createSelectorQuery().select('#comments-id').boundingClientRect(function(rect){\n        // 使页面滚动到响应位置\n        Taro.pageScrollTo({\n            scrollTop: rect.bottom\n        })\n    }).exec()\n}\n")])])]),a("h4",{attrs:{id:"五、taro以及微信小程序开发中遇到的问题总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、taro以及微信小程序开发中遇到的问题总结","aria-hidden":"true"}},[e._v("#")]),e._v(" 五、Taro以及微信小程序开发中遇到的问题总结")]),e._v(" "),a("h5",{attrs:{id:"_1-doc文档的下载与预览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-doc文档的下载与预览","aria-hidden":"true"}},[e._v("#")]),e._v(" 1. doc文档的下载与预览")]),e._v(" "),a("blockquote",[a("p",[e._v("小程序目前提供了wx.downloadFile的API，但目前只支持长传和下载图片，语音，视频 三种类型的文件。doc文件会下载为临时路径的 .myword文件，可供预览（安卓手机默认微信内置浏览器打开,可转发至电脑。ios tbd）。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Taro.showLoading()\nconst params = {\n    url,\n    fileType: \"doc\",\n    success(res) {\n        // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容\n        if (res.statusCode === 200) {\n            const wxPath = res.tempFilePath\n            Taro.openDocument({\n                filePath: wxPath,\n                fileType: \"doc\",\n                success: function (ress) {\n                    Taro.hideLoading()\n                    console.log(ress)\n                },\n                fail: function (resfo) {\n                    Taro.hideLoading()\n                    util.showToast('打开文档失败')\n                }\n            })\n        }\n    },\n    fail: function (resfd) {\n        Taro.hideLoading()\n        util.showToast('文件下载失败')\n    },\n}\nTaro.downloadFile(params).then()\n")])])]),a("h5",{attrs:{id:"_2-获取地理位置，经纬度，用于签到"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-获取地理位置，经纬度，用于签到","aria-hidden":"true"}},[e._v("#")]),e._v(" 2. 获取地理位置，经纬度，用于签到")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("wx.getLocation({\n  type: 'gcj02', // wgs84 返回 gps 坐标，gcj02 返回可用于 wx.openLocation 的坐标\n  success(res) {\n    const { latitude, longitude } = res\n  }\n})\n")])])]),a("blockquote",[a("p",[e._v("①、wx.getLocation，调用前需要 用户授权。scope.userLocation"),a("br"),e._v("\n②、发起签到与扫码签到时，应保证"),a("code",[e._v("type")]),e._v("相同。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('// 用户授权，app.js中配置项\npermission: {\n    "scope.userLocation": {\n        "desc": "获取用户的签到位置"\n    }\n},\n')])])]),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/4/169e6c43a907af8e?w=1077&h=1725&f=png&s=353779",alt:""}})]),e._v(" "),a("h5",{attrs:{id:"_3-不能长按识别-除小程序码外的-二维码-tbd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-不能长按识别-除小程序码外的-二维码-tbd","aria-hidden":"true"}},[e._v("#")]),e._v(" 3. 不能长按识别(除小程序码外的)二维码 (tbd)")]),e._v(" "),a("blockquote",[a("p",[e._v("预览二维码图片以后，不支持识别二维码。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("getEventData(data, tag) {\n    return data.currentTarget.dataset[tag];\n},\npreviewImage = (e) => {\n    const current = getEventData(e, 'src')\n    Taro.previewImage({\n        current: current, // 当前显示图片的http链接   \n        urls: [current] // 需要预览的图片http链接列表   \n    })\n}\n")])])]),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/4/169e6e3c930ca93d?w=1080&h=1716&f=png&s=126282",alt:"二维码"}})]),e._v(" "),a("h4",{attrs:{id:"六、todo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、todo","aria-hidden":"true"}},[e._v("#")]),e._v(" 六、TODO")]),e._v(" "),a("ul",[a("li",[e._v("发挥多端的优势，尝试其他小程序，h5等的打包发布。")]),e._v(" "),a("li",[e._v("继续跟进word文档下载，更换二维码为小程序二维码带参数（"),a("code",[e._v("wxacode.getUnlimited")]),e._v("）")]),e._v(" "),a("li",[e._v("openid对于多端的影响")])]),e._v(" "),a("h4",{attrs:{id:"尾语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#尾语","aria-hidden":"true"}},[e._v("#")]),e._v(" 尾语")]),e._v(" "),a("p",[e._v("==菜的抠脚，大佬轻喷。内容较粗糙，有问题请指正。==\n有必要夸一下，小程序的处理速度还是很快的，两个小时审核就通过了。\n"),a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/4/169e6f3c8fbeeedf?w=1301&h=274&f=png&s=24244",alt:""}})])])},[],!1,null,null,null);t.default=s.exports}}]);